import requests
import json

def get_user_posts_info(username, access_token):
    query = """
    {
      user(username: "%s") {
        edge_owner_to_timeline_media {
          edges {
            node {
              shortcode
              display_url
              caption
              edge_liked_by {
                count
              }
              edge_media_to_comment {
                count
              }
              location
              taken_at_timestamp
            }
          }
        }
      }
    }
    """ % username

    response = requests.post('https://www.instagram.com/graphql/query/',
                             headers={'user-agent': 'Mozilla/5.0'},
                             data={'query_hash': '472f257a40c653c64c666ce877d59d2b',
                                   'variables': json.dumps({'query': query}),
                                   'access_token': access_token})  # Add access token here

    if response.status_code == 200:
        data = response.json()
        if data is not None and 'data' in data and 'user' in data['data'] and 'edge_owner_to_timeline_media' in data['data']['user']:
            edges = data['data']['user']['edge_owner_to_timeline_media']['edges']
            posts_info = []
            for edge in edges:
                node = edge['node']
                post_info = {
                    "shortcode": node['shortcode'],
                    "display_url": node['display_url'],
                    "caption": node['caption'],
                    "likes": node['edge_liked_by']['count'],
                    "comments_count": node['edge_media_to_comment']['count'],
                    "location": node['location'],
                    "timestamp": node['taken_at_timestamp']
                }
                posts_info.append(post_info)
            return posts_info
        else:
            print("Error: Unable to parse response:", data)
    else:
        print("Error:", response.text)

# Example usage:
username = "leomessi"  # Replace with the desired Instagram username
access_token = "IGQWROV0R0clRzalU5eGtEY3JYOEpndkdJaFZAKZAXlPMngycUR5NEpmSGZABRkZA6eldGdTFudVBQTUpiZAVJRTHBrTE1rRGg1VUVQMTE4YjM0VTBPR0d5NUV4WFdNa0RhR1ZAKVFZArdHNVcmVsMEx2NUttMkZAzUUd6RncZD"  # Replace with your obtained Access Token
posts_info = get_user_posts_info(username, access_token)

if posts_info:
    print("User Posts Information:")
    for post_info in posts_info:
        print("Shortcode:", post_info["shortcode"])
        print("Display URL:", post_info["display_url"])
        print("Caption:", post_info["caption"])
        print("Likes:", post_info["likes"])
        print("Comments Count:", post_info["comments_count"])
        print("Location:", post_info["location"])
        print("Timestamp:", post_info["timestamp"])
        print()
